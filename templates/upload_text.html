{% extends 'base.html' %}

{% block title %}{{ project.name }} - ë¦¬ë·° ì‘ì„±{% endblock %}

{% block content %}
<div style="margin-bottom: 24px;">
    <a href="{{ url_for('index') }}" style="color: var(--gray-500); text-decoration: none; font-size: 0.875rem;">
        â† í”„ë¡œì íŠ¸ ëª©ë¡
    </a>
    <h1 style="font-size: 1.5rem; font-weight: 700; margin-top: 8px;">{{ project.name }} - ë¦¬ë·° ì‘ì„±</h1>
    {% if project.description %}
        <p style="color: var(--gray-500); margin-top: 4px;">{{ project.description }}</p>
    {% endif %}
</div>

<form method="POST" id="reviewForm">
    <div class="card">
        <div class="form-group">
            <label class="form-label">ì—…ë¡œë” ì´ë¦„ *</label>
            <input type="text" name="uploader_name" class="form-input" 
                   placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required id="uploaderName">
        </div>
        
        <div class="form-group">
            <label class="form-label">ë¦¬ë·° ì‘ì„± (ìµœëŒ€ 5ê±´, ê° 50~300ì)</label>
            
            {% for i in range(1, 6) %}
            <div style="margin-bottom: 16px;">
                <label style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 4px; display: block;">
                    ë¦¬ë·° {{ i }}
                </label>
                <textarea name="review_{{ i }}" 
                          class="form-input review-textarea" 
                          placeholder="ë¦¬ë·° ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš” (50~300ì)"
                          rows="3"
                          minlength="50"
                          maxlength="300"
                          style="resize: vertical;"></textarea>
                <div class="char-count" id="count_{{ i }}" style="font-size: 0.75rem; color: var(--gray-500); text-align: right; margin-top: 4px;">
                    0 / 300ì
                </div>
            </div>
            {% endfor %}
        </div>
        
        <button type="submit" class="btn btn-primary btn-block" id="submitBtn">
            ë¦¬ë·° ì œì¶œí•˜ê¸°
        </button>
    </div>
</form>

<div style="margin-top: 16px; text-align: center;">
    <a href="{{ url_for('upload', project_id=project.id) }}" style="color: var(--primary); text-decoration: none; font-size: 0.875rem;">
        ğŸ“· ì‚¬ì§„ ì—…ë¡œë“œ í˜ì´ì§€ë¡œ ì´ë™
    </a>
</div>

<style>
.review-textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--gray-300);
    border-radius: 8px;
    font-size: 1rem;
    font-family: inherit;
    box-sizing: border-box;
}

.review-textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.char-count.warning {
    color: var(--warning) !important;
}

.char-count.error {
    color: var(--danger) !important;
}

.char-count.success {
    color: var(--success) !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // ê¸€ì ìˆ˜ ì¹´ìš´íŠ¸
    const textareas = document.querySelectorAll('.review-textarea');
    
    textareas.forEach((textarea, index) => {
        const countEl = document.getElementById('count_' + (index + 1));
        
        textarea.addEventListener('input', function() {
            const len = this.value.length;
            countEl.textContent = len + ' / 300ì';
            
            // ìƒ‰ìƒ ë³€ê²½
            countEl.classList.remove('warning', 'error', 'success');
            if (len > 0 && len < 50) {
                countEl.classList.add('warning');
                countEl.textContent = len + ' / 300ì (ìµœì†Œ 50ì)';
            } else if (len > 300) {
                countEl.classList.add('error');
            } else if (len >= 50 && len <= 300) {
                countEl.classList.add('success');
            }
        });
    });
    
    // í¼ ì œì¶œ ì „ ê²€ì¦
    document.getElementById('reviewForm').addEventListener('submit', function(e) {
        const textareas = document.querySelectorAll('.review-textarea');
        let hasValidReview = false;
        let hasError = false;
        
        textareas.forEach((textarea) => {
            const len = textarea.value.trim().length;
            if (len > 0) {
                if (len < 50) {
                    hasError = true;
                    textarea.style.borderColor = 'var(--danger)';
                } else if (len > 300) {
                    hasError = true;
                    textarea.style.borderColor = 'var(--danger)';
                } else {
                    hasValidReview = true;
                    textarea.style.borderColor = 'var(--success)';
                }
            }
        });
        
        if (!hasValidReview) {
            e.preventDefault();
            alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ë¦¬ë·°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (50~300ì)');
            return;
        }
        
        if (hasError) {
            e.preventDefault();
            alert('ë¦¬ë·°ëŠ” 50ì ì´ìƒ 300ì ì´í•˜ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.');
            return;
        }
        
        // ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™”
        document.getElementById('submitBtn').disabled = true;
        document.getElementById('submitBtn').textContent = 'ì œì¶œ ì¤‘...';
    });
});
</script>
{% endblock %}
